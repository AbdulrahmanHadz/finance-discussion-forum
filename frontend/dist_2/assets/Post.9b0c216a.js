import{_ as y,o as a,d,f,n as v,a as r,q as k,p as b,g as D,u as T,r as c,c as _,w as g,h as i,b as h,j as I,T as U,m as P,t as S,F as M,e as A}from"./index.51d15672.js";import{C as x}from"./CloseIcon.2333a6d7.js";import $ from"./PageNotFound.507250b2.js";const N={props:{content:{type:String,required:!0}}},V={class:"postCard"};function E(t,e,s,l,o,n){return a(),d("td",V,f(s.content),1)}const R=y(N,[["render",E]]);const j={props:{user:{type:Object,required:!0}},methods:{convertDateTime(){return v(this.user.createdAt)}}},O={class:"userCard"},q={class:"username"},L={class:"createdAt"};function B(t,e,s,l,o,n){return a(),d("td",O,[r("p",q,f(s.user.username),1),r("p",L,"Created: "+f(n.convertDateTime()),1)])}const F=y(j,[["render",B]]);const Y={data(){return{userId:null,form:{content:null,postId:null,userId:null},respMessage:null}},created(){this.form.userId=this.userId=k(),this.form.postId=this.postId,this.content!=null&&(this.form.content=this.content)},methods:{close(){this.$emit("close")},send(t){if(this.form.content==null||this.form.content.length==0){this.close();return}if(!this.content||this.content.length==0){this.addNewComment();return}else{this.updateComment();return}},updateInput(t){this.form.content=t.target.value},addNewComment(){this.form.content==null||this.form.content.length==0||b("comments",this.form).then(t=>{let e=t.data.data.id;this.fetchNewComment(e)}).catch(t=>{console.log(t);const e=t.response;if(e){const s=e.data;"message"in s&&(this.respMessage=s.message)}else this.respMessage="Something went wrong"})},fetchNewComment(t){D(`comments/${t}`).then(e=>{let s=e.data.data;this.$emit("new",s),this.close()})},updateComment(){T("comments",this.form.postId,this.form).then(t=>{this.$emit("update",{id:this.postId,editedAt:new Date().toISOString(),content:this.form.content}),this.close()}).catch(t=>{console.log(t);const e=t.response;if(e){const s=e.data;"message"in s&&(this.respMessage=s.message)}else this.respMessage="Something went wrong"})}},components:{CloseIcon:x},props:{postId:{type:String,required:!0},content:{type:String,default:null}}},z={class:"reply-modal-backdrop",id:"modal"},G={class:"reply-modal-base",role:"form",id:"send-reply","aria-label":"Add a reply"},H={class:"reply-modal-header",id:"modalTitle"},J={key:0,class:"reply-modal-header"},K={key:1,class:"error"},Q={key:0,id:"form-div"},W={class:"error"},X={class:"form"},Z=["value"];function tt(t,e,s,l,o,n){const u=c("CloseIcon"),p=c("v-btn");return a(),_(U,{name:"reply-modal-fade"},{default:g(()=>[r("div",z,[r("div",G,[r("div",H,[o.userId!=null?(a(),d("label",J,"Comment")):i("",!0),o.userId==null?(a(),d("p",K,"You need to login to be able to post a comment.")):i("",!0),h(u,{"aria-label":"Close modal",class:"btn-close",onClick:n.close},null,8,["onClick"])]),o.userId!=null?(a(),d("div",Q,[r("p",W,f(o.respMessage),1),r("div",X,[r("textarea",{value:o.form.content,class:"modal-reply",onInput:e[0]||(e[0]=(...m)=>n.updateInput&&n.updateInput(...m))},null,40,Z),h(p,{elevation:"2",class:"btn-green",onClick:n.send},{default:g(()=>[I("Comment")]),_:1},8,["onClick"])])])):i("",!0)])])]),_:1})}const w=y(Y,[["render",tt]]);const et={data(){return{isModalVisible:!1,loggedInUserId:k()}},props:{postData:{type:String,required:!0},userData:{type:String,required:!0},postType:{type:String,default:"comment"}},components:{PostContent:R,PostUser:F,ReplyModal:w},methods:{convertDateTime(t){return v(t)},checkEdited(){return this.postData.editedAt!=null?"Edited: "+this.convertDateTime(this.postData.editedAt):"Posted: "+this.convertDateTime(this.postData.createdAt)},showModal(){this.isModalVisible=!0},closeModal(){this.isModalVisible=!1},checkLoggedInUserToPostAuthor(){return this.loggedInUserId==this.postData.authorId},deletePost(){confirm("Do you really want to delete this comment?")&&P("comments",this.postData.id,{userId:this.postData.authorId}).then(t=>{console.log(t),this.$emit("delete",this.postData.id)}).catch(t=>{console.log(t)})},editComment(t){!this.postData||(console.log(t),this.postData.content=t.content,this.postData.editedAt=t.editedAt)}}},st={key:0,class:"section postSection"},ot={class:"postsTable"},nt={class:"content-footer-row"},at={key:0,class:"content-footer-buttons"},rt={colspan:"2",class:"content-footer-data"};function lt(t,e,s,l,o,n){const u=c("PostUser"),p=c("PostContent"),m=c("v-btn"),C=c("ReplyModal");return s.userData!=null?(a(),d("div",st,[r("table",ot,[r("tr",null,[h(u,{user:s.userData},null,8,["user"]),h(p,{content:s.postData.content},null,8,["content"])]),r("tr",nt,[s.postType!=="post"&&n.checkLoggedInUserToPostAuthor()?(a(),d("td",at,[h(m,{elevation:"2",color:"grey darken-1",onClick:n.showModal},{default:g(()=>[I("Edit")]),_:1},8,["onClick"]),o.isModalVisible?(a(),_(C,{key:0,onClose:n.closeModal,postId:this.postData.id,onUpdate:n.editComment,content:this.postData.content},null,8,["onClose","postId","onUpdate","content"])):i("",!0),h(m,{elevation:"2",color:"red darken-2",onClick:n.deletePost},{default:g(()=>[I("Delete")]),_:1},8,["onClick"])])):i("",!0),r("td",rt,f(n.checkEdited()),1)])])])):i("",!0)}const it=y(et,[["render",lt]]);const ct={components:{PostSection:it,ReplyModal:w},props:{postData:{type:Object,required:!0}},data(){return{postId:this.$route.params.id,postAuthorId:this.postData.authorId,userData:{},postComments:[],isModalVisible:!1,form:{content:null},loggedInUserId:k(),tags:[]}},mounted(){this.addView(),this.fetchUserData(),this.fetchTags()},methods:{addView(){console.log(this.loggedInUserId),console.log(this.postId),b("views",{userId:this.loggedInUserId,postId:this.postId}).then(t=>{console.log(t)}).catch(t=>{console.log(t)})},fetchUserData(){D(`users/${this.postData.authorId}`).then(t=>{let e=t.data.data,s=e.id;s in this.userData||(this.userData[s]=e),this.fetchPostComments()}).catch(t=>{console.log(t)})},fetchPostComments(){let t=0,e=!1;do D("comments",{postIds:[this.postId],offset:t}).then(s=>{let l=s.data,o=l.data;this.postComments.push(...o),l.limit==o.length&&(t+=l.limit,e=!0),e=!1}).catch(s=>{console.log(s)});while(e);this.getCommentsUsers()},getCommentsUsers(){let t=Array.from(new Set(this.postComments.map(e=>e.authorId)));console.log(t),t=t.filter(e=>!Object.keys(this.userData).includes(e)),console.log(t),D("users",{ids:t}).then(e=>{e.data.data.forEach(l=>{let o=l.id;o in this.userData||(this.userData[o]=l)})}).catch(e=>{console.log(e)})},showModal(){k()==null?this.$router.push("/login"):this.isModalVisible=!0},closeModal(){this.isModalVisible=!1},updatePostComments(t){console.log(t),this.postComments.push(t)},checkLoggedInUserToPostAuthor(){return this.loggedInUserId==this.postAuthorId},deletePost(){confirm("Do you really want to delete this post?")&&P("posts",this.postId,{userId:this.postAuthorId}).then(t=>{console.log(t),this.$router.replace("/home")}).catch(t=>{console.log(t)})},editPost(){this.$router.replace({name:"edit_post",params:{id:this.postId}})},fetchTags(){D("tags/post",{ids:[this.postId]}).then(t=>{let s=t.data.data[this.postId],l=S().tags;console.log(s);let o=l.filter(n=>{if(s.includes(n.id))return n});this.tags=o.map(n=>n.name)}).catch(t=>{console.log(t)})},deleteComment(t){this.postComments=this.postComments.filter(e=>e.id!=t)}}},dt={class:"post"},ut={class:"headings pb-3"},ht={class:"tags-footer pb-6"},pt={class:"post-user-buttons"},mt={key:1,class:"post-user-buttons"},_t={class:"postSections"},gt=r("div",{class:"postBreak"},null,-1);function ft(t,e,s,l,o,n){const u=c("v-btn"),p=c("ReplyModal"),m=c("PostSection");return a(),d("div",dt,[r("h3",ut,f(s.postData.title),1),r("h3",ht,f(o.tags.join(", ")),1),r("div",pt,[h(u,{elevation:"2",color:"green lighten-3",onClick:n.showModal},{default:g(()=>[I("Reply")]),_:1},8,["onClick"]),o.isModalVisible?(a(),_(p,{key:0,onClose:n.closeModal,postId:o.postId,onNew:n.updatePostComments},null,8,["onClose","postId","onNew"])):i("",!0),n.checkLoggedInUserToPostAuthor()?(a(),d("div",mt,[h(u,{elevation:"2",color:"grey darken-1",onClick:n.editPost},{default:g(()=>[I("Edit")]),_:1},8,["onClick"]),h(u,{elevation:"2",color:"red darken-2",onClick:n.deletePost},{default:g(()=>[I("Delete")]),_:1},8,["onClick"])])):i("",!0)]),r("div",_t,[Object.keys(o.userData).length!=0&&Object.keys(s.postData).length!=0?(a(),_(m,{key:0,userData:o.userData[s.postData.authorId],postData:s.postData,postType:"post"},null,8,["userData","postData"])):i("",!0),gt,o.postComments.length!=0?(a(!0),d(M,{key:1},A(o.postComments,C=>(a(),_(m,{key:C.id,userData:o.userData[C.authorId],postData:C,onDelete:n.deleteComment},null,8,["userData","postData","onDelete"]))),128)):i("",!0)])])}const Dt=y(ct,[["render",ft]]),It={components:{Post:Dt,PageNotFound:$},data(){return{loadingData:!0,postId:this.$route.params.id,postData:{}}},mounted(){this.fetchPostData()},methods:{fetchPostData(){D(`posts/${this.postId}`).then(t=>{this.postData=t.data.data,this.loadingData=!1}).catch(t=>{console.log(t),t.response.status==404&&(this.loadingData=!1)})}}};function yt(t,e,s,l,o,n){const u=c("Post",!0),p=c("PageNotFound");return a(),d(M,null,[Object.keys(o.postData).length!=0&&!o.loadingData?(a(),_(u,{key:0,postData:o.postData},null,8,["postData"])):i("",!0),Object.keys(o.postData).length==0&&!o.loadingData?(a(),_(p,{key:1})):i("",!0)],64)}const bt=y(It,[["render",yt]]);export{bt as default};
